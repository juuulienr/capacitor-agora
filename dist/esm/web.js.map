{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\nimport type { AgoraPlugin } from './definitions';\n\nexport class AgoraWeb extends WebPlugin implements AgoraPlugin {\n  private client: any;\n  private localVideoTrack: any;\n  private localAudioTrack: any;\n  private appId: string | null = null; \n\n  async initialize(options: { appId: string }): Promise<void> {\n    console.log('[AgoraWeb] initialize called with options:', options);\n\n    const AgoraRTC = (window as any).AgoraRTC;\n    if (!AgoraRTC) {\n      throw new Error('[AgoraWeb] AgoraRTC is not available. Ensure you included the AgoraRTC script.');\n    }\n    \n    if (!options.appId) {\n      throw new Error('App ID is required');\n    }\n\n    this.appId = options.appId;\n\n    // Création d'un client Agora\n    this.client = AgoraRTC.createClient({ mode: 'rtc', codec: 'vp8' });\n    console.log('[AgoraWeb] AgoraRTC client created');\n  }\n\n  async setupLocalVideo(): Promise<void> {\n    console.log('[AgoraWeb] setupLocalVideo called');\n  \n    const AgoraRTC = (window as any).AgoraRTC;\n    if (!AgoraRTC) {\n      throw new Error('[AgoraWeb] AgoraRTC is not available.');\n    }\n  \n    try {\n      // Vérifie si l'élément avec la classe 'livestream' existe\n      const livestreamContainer = document.querySelector('.livestream');\n      if (!livestreamContainer) {\n        throw new Error('[AgoraWeb] No element found with class \"livestream\". Ensure it exists in the DOM.');\n      }\n  \n      // Création des pistes vidéo et audio locales\n      this.localVideoTrack = await AgoraRTC.createCameraVideoTrack();\n      this.localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();\n      console.log('[AgoraWeb] Local video and audio tracks created');\n  \n      // Crée un conteneur pour la vidéo locale\n      const videoContainer = document.createElement('div');\n      videoContainer.id = 'local-video';\n      videoContainer.style.width = '100%';\n      videoContainer.style.height = '100%';\n  \n      // Ajoute le conteneur vidéo à la div avec la classe \"livestream\"\n      livestreamContainer.appendChild(videoContainer);\n      console.log('[AgoraWeb] Video container added to .livestream');\n  \n      // Lecture de la vidéo locale dans le conteneur\n      this.localVideoTrack.play('local-video');\n      console.log('[AgoraWeb] Local video track started');\n    } catch (error) {\n      console.error('[AgoraWeb] Error in setupLocalVideo:', error);\n      throw error;\n    }\n  }\n  \n  async joinChannel(options: { channelName: string; token: string | null; uid: number }): Promise<void> {\n    console.log('[AgoraWeb] joinChannel called with options:', options);\n\n    if (!this.client) {\n      throw new Error('[AgoraWeb] Client is not initialized. Call initialize() first.');\n    }\n\n    if (!this.appId) {\n      throw new Error('App ID is not initialized. Call initialize() first.');\n    }\n\n\n    // Rejoindre un canal avec le client et les pistes locales\n\n    await this.client.setClientRole('host');\n    console.log('Client role set to broadcaster.');\n\n    await this.client.join(this.appId, options.channelName, options.token, options.uid);\n    console.log('[AgoraWeb] Joined channel:', options.channelName);\n\n    if (this.localAudioTrack && this.localVideoTrack) {\n      await this.client.publish([this.localAudioTrack, this.localVideoTrack]);\n      console.log('[AgoraWeb] Local audio and video tracks published');\n    }\n  }\n\n  async switchCamera(): Promise<void> {\n    console.log('[AgoraWeb] switchCamera called');\n    // Implémentation Web spécifique si applicable\n    throw this.unimplemented('[AgoraWeb] switchCamera is not implemented on the web.');\n  }\n\n  async leaveChannel(): Promise<void> {\n    console.log('[AgoraWeb] leaveChannel called');\n\n    if (!this.client) {\n      throw new Error('[AgoraWeb] Client is not initialized.');\n    }\n\n    // Arrête les pistes locales\n    if (this.localVideoTrack) {\n      this.localVideoTrack.stop();\n      this.localVideoTrack.close();\n    }\n    if (this.localAudioTrack) {\n      this.localAudioTrack.stop();\n      this.localAudioTrack.close();\n    }\n\n    // Quitte le canal\n    await this.client.leave();\n    console.log('[AgoraWeb] Left channel');\n  }\n\n  async enableWebViewTransparency(): Promise<void> {\n    console.log('[AgoraWeb] enableWebViewTransparency called');\n    // Implémentation Web spécifique si applicable\n    throw this.unimplemented('[AgoraWeb] enableWebViewTransparency is not implemented on the web.');\n  }\n\n  async disableWebViewTransparency(): Promise<void> {\n    console.log('[AgoraWeb] disableWebViewTransparency called');\n    // Implémentation Web spécifique si applicable\n    throw this.unimplemented('[AgoraWeb] disableWebViewTransparency is not implemented on the web.');\n  }\n}\n"]}